{
	# Global options
	admin off
	# Disable auto HTTPS when behind reverse proxy
	auto_https off
}

:{$PORT:80} {
	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
	}

	# Compression
	encode gzip zstd

	# Proxy API requests to Go backend
	handle /api/* {
		request_body {
			max_size 12MB
		}
		reverse_proxy localhost:8080
	}

	# Serve static files from Hugo build
	handle {
		root * /srv
		try_files {path} {path}/ /index.html
		file_server
	}

	# Logging
	log {
		output stdout
		format console
	}
}
