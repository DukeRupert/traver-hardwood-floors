{{ define "main" }}
<section class="page-hero">
  <div class="container">
    <h1>Contact Us</h1>
    <p class="hero-subtitle">Let's Talk About Your Floor</p>
  </div>
</section>

<section class="contact-section">
  <div class="container">
    <div class="contact-grid">
      <div class="contact-info">
        <h3>Get in Touch</h3>
        <p>We're here to bring your vision to life. Whether you have questions about our services, need a quote, or are ready to schedule your hardwood floor installation or refinishing, our team is just a message away.</p>

        <div class="contact-details">
          <div class="contact-item">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
            <div>
              <strong>Phone</strong><br>
              <a href="tel:{{ .Site.Params.phoneTel }}">{{ .Site.Params.phoneFormatted }}</a>
            </div>
          </div>

          <div class="contact-item">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <div>
              <strong>Location</strong><br>
              {{ .Site.Params.location }}
            </div>
          </div>

          <div class="contact-item">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <div>
              <strong>Service Area</strong><br>
              Helena, Butte, and Bozeman, Montana
            </div>
          </div>
        </div>
      </div>

      <div class="contact-form">
        <h3>Send Us a Message</h3>

        <div id="form-success" class="form-message form-message-success" role="alert" style="display: none;">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <div>
            <strong>Message Sent!</strong>
            <p>Thank you for contacting us. We'll be in touch soon.</p>
          </div>
        </div>

        <div id="form-error" class="form-message form-message-error" role="alert" style="display: none;">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <div>
            <strong>Something went wrong</strong>
            <p id="error-message">Please try again or call us directly.</p>
          </div>
        </div>

        <form id="contact-form">
          <p style="display: none;">
            <label>Don't fill this out if you're human: <input name="bot-field" id="bot-field"></label>
          </p>

          <div class="form-group">
            <label for="name">Name *</label>
            <input type="text" id="name" name="name" required minlength="1" maxlength="50">
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required maxlength="50">
          </div>

          <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" maxlength="50">
          </div>

          <div class="form-group">
            <label for="message">Message *</label>
            <textarea id="message" name="message" required minlength="40" maxlength="500" placeholder="Tell us about your project..."></textarea>
          </div>

          <div class="form-group">
            <div class="cf-turnstile" data-sitekey="{{ site.Params.turnstileSiteKey }}" data-callback="onTurnstileSuccess"></div>
          </div>

          <button type="submit" id="submit-btn" class="btn btn-primary" style="width: 100%;">Send My Estimate Request</button>
        </form>
      </div>
    </div>
  </div>
</section>
{{ end }}

{{ define "scripts" }}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script>
  const API_URL = '{{ site.Params.apiUrl | default "/api/contact" }}';
  let turnstileToken = '';

  function onTurnstileSuccess(token) {
    turnstileToken = token;
  }

  document.getElementById('contact-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target;
    const submitBtn = document.getElementById('submit-btn');
    const successMsg = document.getElementById('form-success');
    const errorMsg = document.getElementById('form-error');
    const errorText = document.getElementById('error-message');

    // Reset messages
    successMsg.style.display = 'none';
    errorMsg.style.display = 'none';

    // Check Turnstile token
    if (!turnstileToken) {
      errorText.textContent = 'Please complete the security check.';
      errorMsg.style.display = 'flex';
      return;
    }

    // Disable button and show loading
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    const formData = {
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      phone: document.getElementById('phone').value,
      message: document.getElementById('message').value,
      botField: document.getElementById('bot-field').value,
      turnstileToken: turnstileToken
    };

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        successMsg.style.display = 'flex';
        form.reset();
        form.style.display = 'none';
      } else {
        const text = await response.text();
        errorText.textContent = text || 'Please try again or call us directly.';
        errorMsg.style.display = 'flex';
        // Reset Turnstile on error
        if (typeof turnstile !== 'undefined') {
          turnstile.reset();
          turnstileToken = '';
        }
      }
    } catch (error) {
      errorText.textContent = 'Network error. Please try again or call us directly.';
      errorMsg.style.display = 'flex';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send My Estimate Request';
    }
  });
</script>
{{ end }}
